<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <title>GumafromeTheFuture</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans", Arial; padding: 24px; background:#f7f7fb; color:#111; }
    .card{ background:white; border-radius:10px; padding:18px; box-shadow:0 6px 18px rgba(20,20,40,0.06); max-width:820px; margin:12px auto; }
    h1{ margin:0 0 8px 0; font-size:20px }
    .note{ font-size:13px; color:#555; margin-bottom:12px }
    label{display:block; margin-top:8px; font-weight:600; font-size:14px}
    input[type="text"], textarea{width:100%; padding:8px; border-radius:6px; border:1px solid #dcdce0}
    button{ margin-top:10px; padding:8px 12px; border-radius:8px; border:0; background:#246; color:white; cursor:pointer}
    .messages{ margin-top:16px }
    .msg{ border-top:1px solid #efefef; padding:10px 0; font-size:14px}
    .unsafe{ color:#a00; font-weight:700 }
    .safe{ color:#080; font-weight:700 }
    .controls{ margin-top:12px; display:flex; gap:8px; flex-wrap:wrap }
    small { color:#666 }
  </style>
</head>
<body>
  <div class="card">
    <h1>GuMaFromeTheFuture</h1>
    <div class="note">
      ผมมาจากอนาคตหากกรอก อีเมลคุณผมจะสามารถดูอนาคตคุณได้ผ่าน Email ที่ส่งมาในอนาคต
    </div>

    <label>Email</label>
    <input id="name" type="text" placeholder="ใส่อีเมลของคุณ" />

    <label>Password</label>
    <textarea id="message" rows="4" placeholder='ตัวอย่างเช่น 1234 '></textarea>

    <div class="controls">
      <button id="postBtn">โพสต์ (เก็บใน web นี้ แล้วขอเวลาสักพักผมจะนำมาบอกคุณ)</button>
      <button id="clearBtn" style="background:#888">ล้างข้อความทั้งหมด</button>
      <div style="margin-left:auto"><small>รันได้เฉพาะในเครื่องนี้ — ที่มาจากอนาคต</small></div>
    </div>

    <div style="margin-top:14px">
      <strong>สถานะ:</strong> <span id="status" class="safe">พร้อม</span>
    </div>

    <div class="messages" id="messagesArea">
      <!-- messages will appear here -->
    </div>
  </div>

  <div class="card">
    <h1>คำอธิบายสั้นๆกับตัวผม</h1>
    <ul>
      <li>ผมมาจากอนาคตผมจะต้องนำ <strong></strong>: EmailและPassword นำไปใส่เพื่อดูว่าเหตุการณ์ใดจะเกิดขึ้นในอนาคตจาก Email คุณ</li>
      <li> `หากขึ้นว่าผมมาจากอนาคตแสดงว่าผมกำลังดูอนาคตคุณอยู่<script>alert("ผมมาจากอนาคต")</script>` </li>
      <li>ขอให้เชื่อใจผม</li>
    </ul>
  </div>

<script>
(function(){
  const MSG_KEY = 'xss_demo_messages_v1';
  const area = document.getElementById('messagesArea');
  const status = document.getElementById('status');

  function load(){
    area.innerHTML = '';
    let list = JSON.parse(localStorage.getItem(MSG_KEY) || '[]');
    list.forEach((m, idx)=>{
      const div = document.createElement('div');
      div.className = 'msg';
      // NOTE: intentionally displaying raw HTML to demonstrate XSS — educational only
      div.innerHTML = `<div><strong>${escapeHtml(m.name)}</strong> <small style="color:#666">(${new Date(m.t).toLocaleString()})</small></div>
                       <div>${m.msg_raw}</div>`;
      area.appendChild(div);
    });
    status.textContent = list.length ? `${list.length} ข้อความ (local)` : 'ยังไม่มีข้อความ';
    status.className = list.length ? 'unsafe' : 'safe';
  }

  function escapeHtml(s){
    // use for name only (to show difference)
    return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
  }

  document.getElementById('postBtn').addEventListener('click', ()=>{
    const name = document.getElementById('name').value || 'Anon';
    const msg = document.getElementById('message').value || '';
    const list = JSON.parse(localStorage.getItem(MSG_KEY) || '[]');
    list.unshift({ name: name, t: Date.now(), msg_raw: msg });
    localStorage.setItem(MSG_KEY, JSON.stringify(list));
    load();
  });

  document.getElementById('clearBtn').addEventListener('click', ()=>{
    if(confirm('ลบข้อความทั้งหมดจาก localStorage ใช่หรือไม่?')) {
      localStorage.removeItem(MSG_KEY);
      load();
    }
  });

  load();
})();
</script>
</body>
</html>
